并发

硬件支持的原子操作：
1.测试并设置(xchg指令)
2.比较并交换(cmpxchg指令)
3.获取并增加(xadd指令)
4.链接加载和条件存储(LL/CS指令)

自旋锁，最多有一个可执行线程持有，其他线程会空转等待锁，因此适合短时间锁定。
对于单cpu来说自旋锁开销比较大，因为线程进行空转而不是放弃cpu导致会浪费一个时间片，但在多cpu下性能不错。
Linux中断上下文使用的就是自旋锁

解决自旋的一个办法是其他线程让出cpu，虽然比自旋好但多个线程是随机调度的，所以仍会造成大量的上下文切换，因此需要进行合理的调度，解决办法之一：队列
让被堵塞的线程进入队列后进行睡眠，执行线程在释放锁后，将队首唤醒进行执行。




